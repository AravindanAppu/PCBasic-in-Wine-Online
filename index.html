<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>js-dos v8 fsReadFile Example</title>
    <link rel="stylesheet" href="https://v8.js-dos.com/latest/js-dos.css" />
    <script src="https://v8.js-dos.com/latest/js-dos.js"></script>
</head>
<body>
    <h2>js-dos v8 File Write and Download</h2>
    <button id="download-btn" disabled>Download File</button>
    <div id="dosbox" style="width: 640px; height: 400px;"></div>

    <script>
        const downloadBtn = document.getElementById("download-btn");

        Dos(document.getElementById("dosbox"), {
            url: "./basic.jsdos", // example bundle
            onEvent: (event, ci) => {
                if (event === "ci-ready") {
                    console.log("Command Interface Ready");

                    // Write a file using fsWriteFile
                    const fileContent = new TextEncoder().encode("Hello from js-dos v8!");
                    ci.fsWriteFile("/example.txt", fileContent).then(() => {
                        console.log("File written.");

                        downloadBtn.disabled = false;
                        downloadBtn.addEventListener("click", () => {
                            ci.fsReadFile("/example.txt").then((data) => {
                                const blob = new Blob([data], { type: "text/plain" });
                                const url = URL.createObjectURL(blob);

                                const a = document.createElement("a");
                                a.href = url;
                                a.download = "example.txt";
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                URL.revokeObjectURL(url);
                            }).catch((err) => {
                                console.error("Read error:", err);
                            });
                        });
                    }).catch((err) => {
                        console.error("Write error:", err);
                    });
                }
            }
        });
    </script>
</body>
</html>
