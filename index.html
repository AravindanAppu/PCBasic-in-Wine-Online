<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>js-dos fsWriteFile and Download Example</title>
    <script src="https://v8.js-dos.com/latest/js-dos.js"></script>
</head>
<body>
    <h2>js-dos File Write, Read, and Download Example</h2>
    <button id="download-btn" disabled>Download File</button>
    <div id="dosbox" style="width: 640px; height: 400px;"></div>

    <script>
        const downloadBtn = document.getElementById("download-btn");

        Dos(document.getElementById("dosbox"), {
            url: "https://v8.js-dos.com/latest/js-dos.js",
            onEvent: (event, ci) => {
                if (event === "ci-ready") {
                    // Write the file using fsWriteFile
                    const fileData = new TextEncoder().encode("Hello from js-dos!");
                    ci.fsWriteFile("/example.txt", fileData).then(() => {
                        console.log("File written successfully.");
                        downloadBtn.disabled = false;

                        // Setup download button click event
                        downloadBtn.addEventListener("click", () => {
                            ci.fsReadFile("/example.txt").then((data) => {
                                const blob = new Blob([data], { type: "text/plain" });
                                const url = URL.createObjectURL(blob);

                                const a = document.createElement("a");
                                a.href = url;
                                a.download = "example.txt";
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                URL.revokeObjectURL(url);
                            }).catch((error) => {
                                console.error("Error reading file:", error);
                            });
                        });
                    }).catch((error) => {
                        console.error("Error writing file:", error);
                    });
                }
            }
        });
    </script>
</body>
</html>
