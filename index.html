<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JS-DOS with Responsive External Keyboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://v8.js-dos.com/latest/js-dos.css" />
  <script src="https://v8.js-dos.com/latest/js-dos.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: black;
      display: flex;
      flex-direction: column;
      font-family: 'Courier New', monospace;
    }
    #dos-root {
      width: 100%;
      height: 55%;
      border-bottom: 2px solid #444;
    }
    #keyboard-container {
      width: 100%;
      height: 45%;
      background: #222;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 5px;
      box-sizing: border-box;
      padding: 10px;
      overflow-y: auto;
    }
    .key-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      margin-bottom: 5px;
    }
    .key {
      background: #444;
      color: white;
      font-size: 1em;
      padding: 12px 18px;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      min-width: 40px;
      text-align: center;
      flex: 0 0 auto;
    }
    .key:hover {
      background: #666;
    }
    .key:active {
      background: #888;
      transform: translateY(1px);
    }
    .key.wide {
      flex: 1 1 80px;
    }
    .key.special {
      background: #5a3c1c;
    }
    .key.shift-active {
      background: #c96 !important;
    }
  </style>
</head>
<body>

  <!-- Emulator -->
  <div id="dos"></div>

  <!-- Keyboard -->
  <div id="keyboard-container">
    <div class="key-row">
      <div class="key special" data-key="27">Esc</div>
      <div class="key special" data-key="9">Tab</div>
      <div class="key special" data-key="20">Caps</div>
      <div class="key special" data-key="17">Ctrl</div>
      <div class="key special" data-key="16">Shift</div>
      <div class="key special" data-key="18">Alt</div>
    </div>
    <div class="key-row">
      <div class="key" data-key="112">F1</div>
      <div class="key" data-key="113">F2</div>
      <div class="key" data-key="114">F3</div>
      <div class="key" data-key="115">F4</div>
      <div class="key" data-key="116">F5</div>
      <div class="key" data-key="117">F6</div>
      <div class="key" data-key="118">F7</div>
      <div class="key" data-key="119">F8</div>
      <div class="key" data-key="120">F9</div>
      <div class="key" data-key="121">F10</div>
    </div>
    <div class="key-row">
      <div class="key" data-key="192">~</div>
      <div class="key" data-key="49">1</div>
      <div class="key" data-key="50">2</div>
      <div class="key" data-key="51">3</div>
      <div class="key" data-key="52">4</div>
      <div class="key" data-key="53">5</div>
      <div class="key" data-key="54">6</div>
      <div class="key" data-key="55">7</div>
      <div class="key" data-key="56">8</div>
      <div class="key" data-key="57">9</div>
      <div class="key" data-key="48">0</div>
      <div class="key" data-key="189">-</div>
      <div class="key" data-key="187">=</div>
      <div class="key wide special" data-key="8">Backspace</div>
    </div>
    <div class="key-row">
      <div class="key wide" data-key="9">Tab</div>
      <div class="key" data-key="81">Q</div>
      <div class="key" data-key="87">W</div>
      <div class="key" data-key="69">E</div>
      <div class="key" data-key="82">R</div>
      <div class="key" data-key="84">T</div>
      <div class="key" data-key="89">Y</div>
      <div class="key" data-key="85">U</div>
      <div class="key" data-key="73">I</div>
      <div class="key" data-key="79">O</div>
      <div class="key" data-key="80">P</div>
      <div class="key" data-key="219">[</div>
      <div class="key" data-key="221">]</div>
      <div class="key" data-key="220">\</div>
    </div>
    <div class="key-row">
      <div class="key wide special" data-key="20">CapsLock</div>
      <div class="key" data-key="65">A</div>
      <div class="key" data-key="83">S</div>
      <div class="key" data-key="68">D</div>
      <div class="key" data-key="70">F</div>
      <div class="key" data-key="71">G</div>
      <div class="key" data-key="72">H</div>
      <div class="key" data-key="74">J</div>
      <div class="key" data-key="75">K</div>
      <div class="key" data-key="76">L</div>
      <div class="key" data-key="186">;</div>
      <div class="key" data-key="222">'</div>
      <div class="key wide special" data-key="13">Enter</div>
    </div>
    <div class="key-row">
      <div class="key wide special" data-key="16">Shift</div>
      <div class="key" data-key="90">Z</div>
      <div class="key" data-key="88">X</div>
      <div class="key" data-key="67">C</div>
      <div class="key" data-key="86">V</div>
      <div class="key" data-key="66">B</div>
      <div class="key" data-key="78">N</div>
      <div class="key" data-key="77">M</div>
      <div class="key" data-key="188">,</div>
      <div class="key" data-key="190">.</div>
      <div class="key" data-key="191">/</div>
      <div class="key wide special" data-key="16">Shift</div>
    </div>
    <div class="key-row">
      <div class="key special" data-key="17">Ctrl</div>
      <div class="key special" data-key="91">Win</div>
      <div class="key special" data-key="18">Alt</div>
      <div class="key wide" data-key="32">Space</div>
      <div class="key special" data-key="18">Alt</div>
      <div class="key special" data-key="93">Menu</div>
      <div class="key special" data-key="17">Ctrl</div>
    </div>
    <div class="key-row">
      <div class="key" data-key="37">←</div>
      <div class="key" data-key="38">↑</div>
      <div class="key" data-key="40">↓</div>
      <div class="key" data-key="39">→</div>
    </div>
  </div>

  <script>
Dos(document.getElementById("dos"), {
            url: "./basic.jsdos",
            backend:"dosboxX",
            backendLocked: false,
            autoStart: true,
            autoSave: false,
            kiosk: true,
        });

    let shiftActive = false;
    let ctrlActive = false;

    const keyboard = document.getElementById("keyboard-container");
    keyboard.addEventListener("click", event => {
      const keyElem = event.target.closest(".key");
      if (!keyElem) return;

      const keyCode = parseInt(keyElem.getAttribute("data-key"));
      if (isNaN(keyCode)) return;

      handleKey(keyCode, keyElem);
    });

    function handleKey(keyCode, keyElem) {
      if (keyCode === 16) { // Shift
        shiftActive = !shiftActive;
        toggleKeyClass(keyElem, shiftActive);
        return;
      }
      if (keyCode === 17) { // Ctrl
        ctrlActive = !ctrlActive;
        toggleKeyClass(keyElem, ctrlActive);
        return;
      }

      simulateKeyEvent(keyCode, true);
      simulateKeyEvent(keyCode, false);

      // Reset Shift after use
      if (shiftActive) {
        shiftActive = false;
        document.querySelectorAll(".key[data-key='16']").forEach(k => k.classList.remove("shift-active"));
      }
      // Reset Ctrl if needed (optional)
    }

    function toggleKeyClass(keyElem, active) {
      keyElem.classList.toggle("shift-active", active);
    }

    function simulateKeyEvent(keyCode, pressed) {
      const eventType = pressed ? "keydown" : "keyup";
      const event = new KeyboardEvent(eventType, {
        keyCode: keyCode,
        which: keyCode,
        bubbles: true,
        cancelable: true
      });
      document.dispatchEvent(event);
    }
  </script>

</body>
</html>
