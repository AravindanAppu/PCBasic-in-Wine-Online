<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GW-BASIC in Browser</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Include js-dos -->
<script src="https://js-dos.com/6.22/current/js-dos.js"></script>
<style>
  body { margin: 0; display: flex; flex-direction: column; height: 100vh; }
  #dosbox { flex: 1; }
  input { margin: 10px; }
</style>
</head>
<body>

<h2>GW-BASIC in Browser</h2>
<input type="file" id="zipInput" accept=".zip">
<div id="dosbox"></div>

<script>
document.getElementById('zipInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const dosboxContainer = document.getElementById('dosbox');

    // Start DOSBox
    const emu = await Dos(emulator => emulator.run(dosboxContainer, {
        w: dosboxContainer.clientWidth,
        h: dosboxContainer.clientHeight,
        // Enable saving of files inside DOSBox
        onEvent: async (event, data) => {
            if (event === "screenReady") {
                console.log("DOSBox ready!");
            }
        }
    }));

    // Convert ZIP file to Uint8Array
    const arrayBuffer = await file.arrayBuffer();
    const uint8Array = new Uint8Array(arrayBuffer);

    // Mount the ZIP as drive C
    await emu.fs.extractZip(uint8Array, "/C");

    // Optional: redirect printer to a text file (LPRINT -> LPT1 -> FILE)
    // DOSBox allows redirecting LPT1 to a file
    // We'll use DOSBox commands
    await emu.runCommand('mount c /C');
    await emu.runCommand('c:');
    // Redirect LPT1 to a file (lpt1.txt)
    await emu.runCommand('mode lpt1: lpt1.txt');

    // Start GWBASIC
    await emu.runCommand('GWBASIC.EXE');

    console.log("GW-BASIC started. You can now load your BAS files.");
});
</script>

</body>
</html>
